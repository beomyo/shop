<!DOCTYPE html>
<html class="no-js" xmlns:th="http://www.thymeleaf.org">
<head>
    <base href="/">
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>注册</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.svg" />

    <!-- ========================= CSS here ========================= -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/LineIcons.3.0.css" />
    <link rel="stylesheet" href="assets/css/tiny-slider.css" />
    <link rel="stylesheet" href="assets/css/glightbox.min.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
</head>

<body>
<header class="header navbar-area">
    <!-- Start Topbar -->
    <div class="topbar">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-4 col-md-4 col-12">
                    <div class="top-left"></div>
                </div>
                <div class="col-lg-4 col-md-4 col-12">
                    <div class="top-middle">
                        <ul class="useful-links"></ul>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-12">
                    <div class="top-end">
                        <ul class="user-login">
                            <li><a href="shopping/login">登录</a></li>
                            <li><a href="shopping/register">注册</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Topbar -->
    <!-- Start Header Middle -->
    <div class="header-middle">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-3 col-md-3 col-7">
                    <a class="navbar-brand" href="shopping/index">
                        <img src="assets/images/logo/logo.svg" alt="Logo">
                    </a>
                </div>
                <div class="col-lg-4 col-md-2 col-5">
                    <div class="middle-right-area">
                        <div class="nav-hotline"><h3><span></span></h3></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Start Breadcrumbs -->
<div class="breadcrumbs">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 col-md-6 col-12">
                <div class="breadcrumbs-content">
                    <h1 class="page-title">注册</h1>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-12">
                <ul class="breadcrumb-nav">
                    <li><a href="shopping/index"><i class="lni lni-home"></i> 首页</a></li>
                    <li>注册</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End Breadcrumbs -->

<!-- Start Account Register Area -->
<div class="account-login section">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 offset-lg-3 col-md-10 offset-md-1 col-12">
                <div class="register-form">
                    <div class="title">
                        <h3>还没账户? 注册</h3>
                        <p>填写信息完成注册</p>
                    </div>
                    <form class="row" method="post" id="register-form">
                        <div class="col-sm-12">
                            <div class="form-group">
                                <label for="reg-nickname">昵称</label>
                                <input class="form-control" type="text" id="reg-nickname" required>
                                <label for="reg-username">用户名</label>
                                <input class="form-control" type="text" id="reg-username" required>
                                <label for="reg-tel">电话号码</label>
                                <input class="form-control" type="text" id="reg-tel" required>
                                <label for="reg-pass">密码</label>
                                <input class="form-control" type="password" id="reg-pass" required>
                                <label for="reg-pass-confirm">确认密码 </label>
                                <input class="form-control" type="password" id="reg-pass-confirm" required>
                            </div>
                        </div>
                        <div class="button">
                            <button class="btn" type="submit">注册</button>
                        </div>
                        <p class="outer-link">已有账户? <a href="shopping/login">点我登录</a></p>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========================= JS here ========================= -->
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/tiny-slider.js"></script>
<script src="assets/js/glightbox.min.js"></script>
<script src="assets/js/main.js"></script>
<!-- 引入 layui -->
<script src="layui/layui.all.js"></script>

<script>
    // layui.use(['jquery', 'layer'], function(){
    //     var $ = layui.$;
    //     var layer = layui.layer;
    //
    //     // 检查登录状态
    //     function checkLoginStatus() {
    //         $.ajax({
    //             url: 'shopping/iflogin',
    //             type: 'GET',
    //             dataType: 'json',
    //             success: function(res) {
    //                 if (res && res.username) {
    //                     updateUserMenu(res.username);
    //                 }
    //             },
    //             error: function(xhr, status, error) {
    //                 console.error('登录状态检查失败:', error);
    //             }
    //         });
    //     }
    //
    //     // 更新用户菜单
    //     function updateUserMenu(username) {
    //         var userHtml = `
    //         <li class="nav-item dropdown">
    //             <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">${username}</a>
    //             <ul class="dropdown-menu" style="background-color: #081828; min-width: 102px; padding: 0.5rem 0;">
    //                 <li><a class="dropdown-item" href="page/userinfo">个人信息</a>
    //                 <a class="dropdown-item logout-btn" ">注销</a></li>
    //             </ul>
    //         </li>
    //     `;
    //         $('.user-login').html(userHtml);
    //
    //         // 初始化 Bootstrap 下拉菜单并添加悬停效果
    //         $('.dropdown').hover(
    //             function() {
    //                 $(this).find('.dropdown-menu').stop(true, true).slideDown(200); // 鼠标移入时显示
    //                 $(this).addClass('show'); // 添加 show 类以保持 Bootstrap 样式
    //                 $(this).find('.dropdown-toggle').attr('aria-expanded', 'true');
    //             },
    //             function() {
    //                 $(this).find('.dropdown-menu').stop(true, true).slideUp(200); // 鼠标移出时隐藏
    //                 $(this).removeClass('show');
    //                 $(this).find('.dropdown-toggle').attr('aria-expanded', 'false');
    //             }
    //         );
    //
    //         // 绑定注销事件
    //         $('.logout-btn').on('click', handleLogout);
    //     }
    //
    //     // 处理注销
    //     function handleLogout() {
    //         layer.confirm('确定要注销吗？', {icon: 3}, function(index) {
    //             $.ajax({
    //                 url: 'shopping/logout',
    //                 type: 'POST',
    //                 dataType: 'json',
    //                 success: function(res) {
    //                     if (res> 0) {
    //                         layer.msg('注销成功', {icon: 1});
    //                         setTimeout(() => location.href = 'shopping/index', 1000);
    //                     } else {
    //                         layer.msg('注销失败: ' + (res.msg || '未知错误'), {icon: 2});
    //                     }
    //                 },
    //                 error: function() {
    //                     layer.msg('网络错误，请稍后重试', {icon: 2});
    //                 }
    //             });
    //             layer.close(index);
    //         });
    //     }
    //
    //     // 初始化
    //     $(document).ready(function() {
    //         checkLoginStatus();
    //     });
    // });

    layui.use(['layer', 'jquery'], function(){
        var layer = layui.layer;
        var $ = layui.$;

        // 表单提交事件
        $('#register-form').on('submit', function(e){
            e.preventDefault();

            // 获取表单数据
            var nickname = $('#reg-nickname').val().trim();
            var username = $('#reg-username').val().trim();
            var tel = $('#reg-tel').val().trim();
            var password = $('#reg-pass').val().trim();
            var confirmPass = $('#reg-pass-confirm').val().trim();

            // 表单验证
            if (!nickname) {
                layer.msg('请输入昵称');
                return;
            }
            if (!username) {
                layer.msg('请输入用户名');
                return;
            }
            if (!tel) {
                layer.msg('请输入手机号');
                return;
            }
            if (!/^1[3-9]\d{9}$/.test(tel)) {
                layer.msg('手机号格式不正确');
                return;
            }
            if (!password) {
                layer.msg('请输入密码');
                return;
            }
            if (password !== confirmPass) {
                layer.msg('两次密码输入不一致');
                return;
            }

            // 发送注册请求
            $.ajax({
                url: 'shopping/doregister',
                type: 'POST',
                dataType: 'json',
                data: {
                    nickname: nickname,
                    username: username,
                    tel: tel,
                    password: password
                },
                success: function(res) {
                    if (res > 0) {
                        layer.msg('注册成功，即将跳转到登录页', {
                            icon: 1,
                            time: 1000
                        }, function(){
                            window.location.href = 'shopping/login';
                        });
                    } else if(res<0) {
                        layer.msg('注册失败，用户名已存在!', {icon: 2});
                    }else {
                        layer.msg('注册失败，请检查信息后重试', {icon: 2});
                    }
                },
                error: function() {
                    layer.msg('网络错误，请稍后重试', {icon: 2});
                }
            });
        });
    });
</script>

</body>
</html>